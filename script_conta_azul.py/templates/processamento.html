<!DOCTYPE html>
<html>
<head>
    <title>Processamento</title>
    <link rel="stylesheet" href="/static/style.css">

    <style>
        .spinner {
            margin: 10px auto;
            width: 38px;
            height: 38px;
            border: 4px solid #444;
            border-top-color: #00c8ff;
            border-radius: 50%;
            animation: spin 0.7s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .log-box {
            background: #0f0f0f;
            border: 1px solid #444;
            padding: 15px;
            margin-top: 25px;
            border-radius: 12px;
            max-height: 420px;
            overflow-y: auto;
            font-family: "Courier New", monospace;
            white-space: pre-line;
            text-align: left;
        }

        .btn-download {
            background: #008cff;
            padding: 12px;
            border-radius: 8px;
            display: inline-block;
            margin-top: 20px;
        }
    </style>
</head>

<body onload="formatLogs()">

<div class="card">

    <h2>âœ” Processamento concluÃ­do!</h2>

    <div class="spinner"></div>

    <p>Arquivo enviado por:</p>
    <h3>{{ usuario }} â€” {{ setor }}</h3>

    <p><b>Modo:</b> {{ modo }}</p>
    <p><b>Tempo total:</b> {{ tempo }} segundos</p>

    <div id="logs-box" class="log-box"></div>

    <a href="/download/{{ log_file }}" class="btn btn-download">ðŸ“„ Baixar log</a>
    <br><br>
    <a href="/" class="btn">Voltar</a>

</div>

<script>
    function formatLogs() {
        const raw = `{{ logs }}`;
        const box = document.getElementById("logs-box");

        raw.split("\n").forEach(line => {
            const div = document.createElement("div");
            div.textContent = line;

            if (line.includes("START")) div.style.color = "#00afff";
            if (line.includes("Inserindo")) div.style.color = "#ffd800";
            if (line.includes("Removendo")) div.style.color = "#ff9900";
            if (line.includes("sucesso")) div.style.color = "#18ff6d";
            if (line.includes("FINISH")) div.style.color = "#00ff91";
            if (line.includes("Erro")) div.style.color = "#ff4040";

            box.appendChild(div);
        });

        box.scrollTop = box.scrollHeight;
    }
</script>

</body>
</html>
